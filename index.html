<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="edition" content="SHA_PLACEHOLDER">
<title>Entropy vs Order — aivars.se</title>
<!-- Build: SHA_PLACEHOLDER -->
<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#080810}
canvas{display:block;width:100%;height:100%}
body::after{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at center,transparent 40%,rgba(8,8,16,0.55) 100%);pointer-events:none;z-index:1}
#ui{position:fixed;bottom:20px;left:20px;font:11px/1.6 'Courier New',monospace;color:rgba(180,180,190,0.4);z-index:10;user-select:none;pointer-events:none;opacity:0;transition:opacity .5s}
#ui.show{opacity:1}
#meta{position:fixed;bottom:16px;right:20px;font:10px/1.4 'Courier New',monospace;color:rgba(180,180,190,0.15);z-index:10;user-select:none;pointer-events:none;text-align:right}
#hint{position:fixed;top:20px;right:20px;font:10px 'Courier New',monospace;color:rgba(180,180,190,0.2);z-index:10;user-select:none;pointer-events:none;transition:opacity 3s}
</style>
</head>
<body id="artwork-root">
<canvas id="c" aria-label="Entropy vs Order — generative artwork"></canvas>
<div id="ui">
  <div id="phase-label">phase: order</div>
  <div>1·2·3 phase | 0 auto | space pause</div>
  <div>mouse: force field</div>
</div>
<div id="meta"><span id="seed-el"></span><br><span id="ed-el"></span></div>
<div id="hint">? controls</div>
<script>
(function(){'use strict';

var SHA='SHA_PLACEHOLDER';

/* ── PRNG (mulberry32) ── */
function mulberry32(a){return function(){a|=0;a=a+0x6D2B79F5|0;var t=Math.imul(a^a>>>15,1|a);t=t+Math.imul(t^t>>>7,61|t)^t;return((t^t>>>14)>>>0)/4294967296}}

function getSeed(){var p=new URLSearchParams(location.search),s=p.get('seed');return s!==null&&s!==''&&!isNaN(+s)?+s:Math.floor(Math.random()*999999)+1}

var seed=getSeed(),rng=mulberry32(seed),resetRng=mulberry32(seed+77777);

/* ── Perlin noise ── */
var perm=new Uint8Array(512);
function buildPerm(r){var p=new Uint8Array(256);for(var i=0;i<256;i++)p[i]=i;for(var i=255;i>0;i--){var j=(r()*(i+1))|0;var t=p[i];p[i]=p[j];p[j]=t}for(var i=0;i<512;i++)perm[i]=p[i&255]}
function fade(t){return t*t*t*(t*(t*6-15)+10)}
function _lerp(a,b,t){return a+t*(b-a)}
function grad2(h,x,y){var v=h&3;return((v&1)?-x:x)+((v&2)?-y:y)}
function noise2(x,y){var xi=Math.floor(x)&255,yi=Math.floor(y)&255,xf=x-Math.floor(x),yf=y-Math.floor(y),u=fade(xf),v=fade(yf);return _lerp(_lerp(grad2(perm[perm[xi]+yi],xf,yf),grad2(perm[perm[xi+1]+yi],xf-1,yf),u),_lerp(grad2(perm[perm[xi]+yi+1],xf,yf-1),grad2(perm[perm[xi+1]+yi+1],xf-1,yf-1),u),v)}
function fbm(x,y,oct){var v=0,a=1,f=1;for(var i=0;i<oct;i++){v+=noise2(x*f,y*f)*a;a*=0.5;f*=2}return v}

/* ── Canvas ── */
var cv=document.getElementById('c'),ctx=cv.getContext('2d'),W,H;
var paused=false,userPaused=false,fid;
var reducedMotion=matchMedia('(prefers-reduced-motion:reduce)').matches;

function resize(){
  var d=Math.min(devicePixelRatio||1,2);
  W=innerWidth;H=innerHeight;
  cv.width=W*d;cv.height=H*d;
  ctx.setTransform(d,0,0,d,0,0);
}

/* ── Palette (4 colors: bg + 3 drawing) ── */
var BG=[8,8,16];
var C_ORDER=[207,194,176];
var C_TENSION=[168,112,80];
var C_ENTROPY=[96,120,144];

/* ── Config ── */
var MAX_P=1200,RED_P=300,MOB_P=600,pCount;
var PHASE_DUR=60,TRANS_DUR=12;

/* ── State ── */
var particles=[],gTime=0,pTime=0,manualPhase=-1;
var symN,timeStep;

/* ── Mouse ── */
var mx=-9999,my=-9999,mActive=false;
cv.addEventListener('mousemove',function(e){mx=e.clientX;my=e.clientY;mActive=true});
cv.addEventListener('mouseleave',function(){mActive=false});
cv.addEventListener('touchmove',function(e){e.preventDefault();mx=e.touches[0].clientX;my=e.touches[0].clientY;mActive=true},{passive:false});
cv.addEventListener('touchend',function(){mActive=false});

/* ── Particle ── */
function mkParticle(r){
  var cw=W/2,ch=H/2,spread=Math.min(W,H)*0.38;
  var a=r()*Math.PI*2,d=r()*spread;
  return{x:cw+Math.cos(a)*d,y:ch+Math.sin(a)*d,vx:0,vy:0,
    life:0,maxLife:400+r()*600,
    alpha:0.007+r()*0.023,sz:0.4+r()*1.1,
    ct:r(),targetR:0.12+r()*0.28,noff:r()*1000}
}
function rstParticle(p,r){
  var cw=W/2,ch=H/2,spread=Math.min(W,H)*0.38;
  var a=r()*Math.PI*2,d=r()*spread;
  p.x=cw+Math.cos(a)*d;p.y=ch+Math.sin(a)*d;
  p.vx=0;p.vy=0;p.life=0;p.maxLife=400+r()*600;
  p.alpha=0.007+r()*0.023;p.sz=0.4+r()*1.1;
  p.ct=r();p.targetR=0.12+r()*0.28;p.noff=r()*1000;
}
function initParticles(){
  pCount=reducedMotion?RED_P:(W<768?MOB_P:MAX_P);
  particles=[];
  for(var i=0;i<pCount;i++)particles.push(mkParticle(rng));
}

/* ── Phase system ── */
function getPhase(){
  if(manualPhase>=0)return{idx:manualPhase,blend:0};
  var total=PHASE_DUR+TRANS_DUR;
  if(pTime>=total*3-TRANS_DUR)return{idx:2,blend:0};
  var cycle=pTime%(total*3);
  var idx=Math.min(Math.floor(cycle/total),2),within=cycle-idx*total;
  var b=0;
  if(within>PHASE_DUR&&idx<2){b=(within-PHASE_DUR)/TRANS_DUR;b=b*b*(3-2*b)}
  return{idx:idx,blend:b};
}
function phaseT(ph){return ph.idx+ph.blend}

/* ── Color ── */
function lerpC(a,b,t){return[a[0]+(b[0]-a[0])*t,a[1]+(b[1]-a[1])*t,a[2]+(b[2]-a[2])*t]}
function getColor(ct,pt){
  var s=ct*0.3+(pt/2)*0.7;
  s=Math.max(0,Math.min(1,s));
  if(s<0.5)return lerpC(C_ORDER,C_TENSION,s*2);
  return lerpC(C_TENSION,C_ENTROPY,(s-0.5)*2);
}

/* ── Phase parameters ── */
function phaseParams(pt){
  var t=Math.min(pt/2,1);
  return{
    orbital:_lerp(0.65,0.02,t),
    radial:_lerp(0.7,0.0,t),
    symStr:_lerp(0.55,0.0,t),
    noiseStr:_lerp(0.03,0.85,t),
    noiseScl:_lerp(0.003,0.006,t),
    damp:_lerp(0.955,0.988,t),
    fadeRate:_lerp(0.038,0.01,t),
    jitter:_lerp(0,0.12,t)
  };
}

/* ── Draw ── */
function draw(){
  var ph=getPhase(),pt=phaseT(ph),pp=phaseParams(pt);

  ctx.fillStyle='rgba('+BG[0]+','+BG[1]+','+BG[2]+','+pp.fadeRate.toFixed(4)+')';
  ctx.fillRect(0,0,W,H);

  gTime+=timeStep;
  pTime+=1/60;

  var cw=W/2,ch=H/2,minD=Math.min(W,H);

  for(var i=0;i<pCount;i++){
    var p=particles[i];
    var dx=p.x-cw,dy=p.y-ch;
    var r=Math.sqrt(dx*dx+dy*dy)+0.01;
    var theta=Math.atan2(dy,dx);

    /* Orbital (tangential) — faster near center */
    var orbSpeed=pp.orbital*(1+0.4/(1+r*0.005));
    var tx=-dy/r*orbSpeed,ty=dx/r*orbSpeed;

    /* Radial (attract to target orbit) */
    var pOptR=minD*p.targetR;
    var rForce=(pOptR-r)*0.0008*pp.radial;
    var rx=dx/r*rForce,ry=dy/r*rForce;

    /* Symmetric perturbation */
    var symAngle=theta*symN;
    var symPert=noise2(Math.cos(symAngle)*r*0.005+gTime*0.2,Math.sin(symAngle)*r*0.005)*pp.symStr;

    /* Noise flow */
    var nAngle=fbm(p.x*pp.noiseScl+gTime*0.1+p.noff*0.001,p.y*pp.noiseScl+gTime*0.07,3)*Math.PI*4;
    var nx=Math.cos(nAngle)*pp.noiseStr,ny=Math.sin(nAngle)*pp.noiseStr;

    /* Jitter via noise (deterministic) */
    var jx=noise2(p.x*0.05+gTime*5,p.y*0.05)*pp.jitter;
    var jy=noise2(p.x*0.05,p.y*0.05+gTime*5)*pp.jitter;

    /* Mouse force field */
    var mfx=0,mfy=0;
    if(mActive){
      var mdx=mx-p.x,mdy=my-p.y;
      var md=Math.sqrt(mdx*mdx+mdy*mdy)+1;
      if(md<180){
        var mf=(180-md)/180*0.1;
        mfx=(-mdx/md*0.4-mdy/md*0.3)*mf;
        mfy=(-mdy/md*0.4+mdx/md*0.3)*mf;
      }
    }

    /* Sum forces */
    var fx=tx*(1+symPert)+rx+nx+jx+mfx;
    var fy=ty*(1+symPert)+ry+ny+jy+mfy;

    p.vx=p.vx*pp.damp+fx*0.08;
    p.vy=p.vy*pp.damp+fy*0.08;
    p.x+=p.vx;p.y+=p.vy;
    p.life++;

    /* Opacity envelope */
    var lf=p.life/p.maxLife,op=p.alpha;
    if(lf<0.06)op*=lf/0.06;
    else if(lf>0.85)op*=(1-lf)/0.15;

    /* Vignette — subtle edge dimming */
    var distC=r/(minD*0.5);
    op*=1-Math.pow(Math.min(distC,1),2)*0.3;

    /* Orbit proximity boost in ordered phases */
    if(pp.radial>0.1){
      var orbitFit=1-Math.min(Math.abs(r-pOptR)/(minD*0.08),1);
      op*=_lerp(1,0.4+orbitFit*0.6,pp.radial);
    }

    /* Reset if dead or out of bounds */
    if(p.life>p.maxLife||p.x<-60||p.x>W+60||p.y<-60||p.y>H+60){
      rstParticle(p,resetRng);continue;
    }

    var col=getColor(p.ct,pt);
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.sz,0,6.2832);
    ctx.fillStyle='rgba('+Math.round(col[0])+','+Math.round(col[1])+','+Math.round(col[2])+','+op.toFixed(4)+')';
    ctx.fill();
  }

  /* Phase label */
  var names=['order','tension','entropy'];
  var label=names[ph.idx];
  if(ph.blend>0.01&&ph.idx<2)label+=' \u2192 '+names[ph.idx+1];
  document.getElementById('phase-label').textContent='phase: '+label;
}

function loop(){if(!paused){draw();fid=requestAnimationFrame(loop)}}

/* ── UI ── */
var uiShow=false;
setTimeout(function(){document.getElementById('hint').style.opacity='0'},4000);

document.addEventListener('keydown',function(e){
  if(e.key==='?'){uiShow=!uiShow;document.getElementById('ui').classList.toggle('show',uiShow)}
  else if(e.key==='1'){manualPhase=0}
  else if(e.key==='2'){manualPhase=1}
  else if(e.key==='3'){manualPhase=2}
  else if(e.key==='0'){manualPhase=-1}
  else if(e.key===' '){e.preventDefault();paused=!paused;userPaused=paused;if(!paused)loop()}
});

/* ── Visibility (pause when tab hidden) ── */
document.addEventListener('visibilitychange',function(){
  if(document.hidden){if(fid)cancelAnimationFrame(fid);paused=true}
  else if(!userPaused){paused=false;loop()}
});

/* ── Resize ── */
addEventListener('resize',function(){
  resize();
  ctx.fillStyle='rgb('+BG[0]+','+BG[1]+','+BG[2]+')';
  ctx.fillRect(0,0,W,H);
});

/* ── Reduced motion ── */
matchMedia('(prefers-reduced-motion:reduce)').addEventListener('change',function(e){
  reducedMotion=e.matches;
  timeStep=reducedMotion?0.0003:0.0015;
  if(reducedMotion&&pCount>RED_P){particles.length=RED_P;pCount=RED_P}
});

/* ── Init ── */
function init(){
  rng=mulberry32(seed);
  resetRng=mulberry32(seed+77777);
  buildPerm(rng);
  symN=4+((rng()*4)|0);
  timeStep=reducedMotion?0.0003:0.0015;
  resize();
  gTime=0;pTime=0;
  ctx.fillStyle='rgb('+BG[0]+','+BG[1]+','+BG[2]+')';
  ctx.fillRect(0,0,W,H);
  initParticles();
  document.getElementById('seed-el').textContent='seed '+seed;
  document.getElementById('ed-el').textContent='ed. '+SHA.substring(0,7);
  if(fid)cancelAnimationFrame(fid);
  paused=false;userPaused=false;
  loop();
}

init();
})();
</script>
</body>
</html>
